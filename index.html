<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<title>Ø§ÙˆÙ‚Ø§Øª Ø´Ø±Ø¹ÛŒ</title>
<style>
body {
  font-family: sans-serif;
  background: #f5f5f5;
  text-align: center;
}
#cover {

  background-color: #2777c2;  /* Ø±Ù†Ú¯ Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ Ú©Ø§Ø±Øª */
  border: 2px solid #0077cc; /* Ø®Ø· Ø¯ÙˆØ± Ú©Ø§Ø±Øª */
  border-radius: 12px;       /* Ú¯ÙˆØ´Ù‡â€ŒÙ‡Ø§ÛŒ Ú¯Ø±Ø¯ */
  padding: 20px;             /* ÙØ§ØµÙ„Ù‡ Ø¯Ø§Ø®Ù„ÛŒ Ù…Ø­ØªÙˆØ§ */
  height: 300px;             /* Ø·ÙˆÙ„*/
  width: 300px;              /* Ø¹Ø±Ø¶ Ú©Ø§Ø±Øª */
  margin: 20px auto;         /* ÙˆØ³Ø· ØµÙØ­Ù‡ Ù‚Ø±Ø§Ø± Ú¯Ø±ÙØªÙ† Ùˆ ÙØ§ØµÙ„Ù‡ Ø§Ø² Ø¨Ø§Ù„Ø§/Ù¾Ø§ÛŒÛŒÙ† */
  box-shadow: 0 4px 8px rgba(0,0,0,0.2); /* Ø³Ø§ÛŒÙ‡ Ø¨Ø±Ø§ÛŒ Ø¹Ù…Ù‚ Ø¯Ø§Ø¯Ù† */
  text-align: center;        /* Ù…ØªÙ† ÙˆØ³Ø· */
}
</style>
</head>

<body>
<div id="cover">
<h2>Ø§ÙˆÙ‚Ø§Øª Ø´Ø±Ø¹ÛŒ Ø§Ù…Ø±ÙˆØ²</h2>
<button id="btn">Ù†Ù…Ø§ÛŒØ´ Ø§ÙˆÙ‚Ø§Øª</button>
<div id="output"></div>
</div>
<script>
const deg2rad = d => d * Math.PI / 180;
const rad2deg = r => r * 180 / Math.PI;

function julianDay(date) {
  return date / 86400000 + 2440587.5;
}

function solarPosition(jd) {
  const T = (jd - 2451545.0) / 36525;
  const L0 = (280.46646 + T * (36000.76983 + T * 0.0003032)) % 360;
  const M = 357.52911 + T * (35999.05029 - 0.0001537 * T);
  const e = 0.016708634 - T * (0.000042037 + 0.0000001267 * T);

  const C =
    Math.sin(deg2rad(M)) * (1.914602 - T * (0.004817 + 0.000014 * T)) +
    Math.sin(deg2rad(2 * M)) * (0.019993 - 0.000101 * T) +
    Math.sin(deg2rad(3 * M)) * 0.000289;

  const trueLong = L0 + C;
  const omega = 125.04 - 1934.136 * T;
  const lambda = trueLong - 0.00569 - 0.00478 * Math.sin(deg2rad(omega));
  const epsilon = 23.439291 - 0.0130042 * T;

  const declination = rad2deg(
    Math.asin(Math.sin(deg2rad(epsilon)) * Math.sin(deg2rad(lambda)))
  );

  const y = Math.tan(deg2rad(epsilon / 2)) ** 2;
  const eqTime = 4 * rad2deg(
    y * Math.sin(2 * deg2rad(L0)) -
    2 * e * Math.sin(deg2rad(M)) +
    4 * e * y * Math.sin(deg2rad(M)) * Math.cos(2 * deg2rad(L0)) -
    0.5 * y * y * Math.sin(4 * deg2rad(L0)) -
    1.25 * e * e * Math.sin(2 * deg2rad(M))
  );

  return { declination, eqTime };
}

function solarNoon(longitude, timezone, eqTime) {
  return 12 + timezone - longitude / 15 - eqTime / 60;
}

function sunAngleTime(lat, decl, angle) {
  const h = deg2rad(angle);
  const phi= deg2rad(lat);
  const delta = deg2rad(decl);

  const cosH =
    (Math.sin(h) - Math.sin(phi) * Math.sin(delta)) /
    (Math.cos(phi) * Math.cos(delta));

  if (cosH < -1 || cosH > 1) return null;
  return rad2deg(Math.acos(cosH)) / 15;
}

function toClock(t) {
  const h = Math.floor(t);
  const m = Math.floor((t - h) * 60);
  return `${h.toString().padStart(2,"0")}:${m.toString().padStart(2,"0")}`;
}
function asrHourAngle(lat, declination, factor) {
    const phi = deg2rad(lat);
    const delta = deg2rad(declination);

    // Ø§Ø±ØªÙØ§Ø¹ Ø®ÙˆØ±Ø´ÛŒØ¯ Ø¯Ø± Ø¹ØµØ±
    const h = Math.atan(1 / (factor + Math.tan(Math.abs(phi - delta))));

    // Ø²Ø§ÙˆÛŒÙ‡ Ø³Ø§Ø¹ØªÛŒ
    const cosH =
        (Math.sin(h) - Math.sin(phi) * Math.sin(delta)) /
        (Math.cos(phi) * Math.cos(delta));

    if (cosH < -1 || cosH > 1) return null;

    return rad2deg(Math.acos(cosH)) / 15;
}
function getUserLocation(callback) {
  if (!navigator.geolocation) {
    alert("Ù…Ø±ÙˆØ±Ú¯Ø± Ø´Ù…Ø§ Ø§Ø² Ù…ÙˆÙ‚Ø¹ÛŒØª Ù…Ú©Ø§Ù†ÛŒ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ù…ÛŒâ€ŒÚ©Ù†Ø¯");
    return;
  }

  navigator.geolocation.getCurrentPosition(
    // Ù…ÙˆÙÙ‚
    position => {
      const lat = position.coords.latitude;
      const lng = position.coords.longitude;
      callback(lat, lng);
    },

    // Ø®Ø·Ø§ â† Ø§ÛŒÙ†Ø¬Ø§Ø³Øª ğŸ‘ˆ
    error => {
      alert("Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ù…ÙˆÙ‚Ø¹ÛŒØª Ù…Ú©Ø§Ù†ÛŒ Ø¯Ø§Ø¯Ù‡ Ù†Ø´Ø¯. Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ù…ÙˆÙ‚Ø¹ÛŒØª Ù¾ÛŒØ´â€ŒÙØ±Ø¶.");

      // Ù…Ø®ØªØµØ§Øª Ù¾ÛŒØ´â€ŒÙØ±Ø¶ (Ù‚Ù…)
      const lat = 34.6416;
      const lng = 50.8746;
      callback(lat, lng);
    }
  );
}

function getTimezone() {
  return -new Date().getTimezoneOffset() / 60;
}

document.getElementById("btn").addEventListener("click", showTimes);

function showTimes() {
    getUserLocation((lat, lng) => {
    const tz = getTimezone();
    
  const date = new Date();
  

  const jd = julianDay(date);
  const { declination, eqTime } = solarPosition(jd);
  const noon = solarNoon(lng, tz, eqTime);
  const h12 = sunAngleTime(lat, declination, -12);
  const sunMinus12=noon-h12; 
  const sunriseDiff=sunAngleTime(lat,declination,-0.833);
const sunrise=noon-sunriseDiff;
const asrDiff = asrHourAngle(lat, declination, 1); // Ø´ÛŒØ¹Ù‡
const asrTime = noon + asrDiff;
const sunsetDiff=sunAngleTime(lat,declination,-0.833);
const sunset=noon+sunsetDiff;
const maghribDiff=sunAngleTime(lat,declination,-4.5);
const maghrib=noon+maghribDiff;
const ishaDiff= sunAngleTime(lat, declination,-9);
const isha=noon+ishaDiff;
const fajrDiff = sunAngleTime(lat, declination, -17.7);
const fajr = noon - fajrDiff;
const nightDuration =(24 - maghrib) + fajr;
const midnight = maghrib + nightDuration / 2;

// Ø¹ØµØ± (Ø´Ø§ÙØ¹ÛŒ = 1)
// Ø¹ØµØ± (Ø´ÛŒØ¹Ù‡ =1.11) 
  document.getElementById("output").innerHTML = "Ø§Ø°Ø§Ù† ØµØ¨Ø­ ÛŒØ§ ÙØ¬Ø± ØµØ§Ø¯Ù‚ :"+toClock(sunMinus12)+"<br>"+
  "Ø·Ù„ÙˆØ¹ Ø¢ÙØªØ§Ø¨ :"+toClock(sunrise)+"<br>"+"Ø§Ø°Ø§Ù† Ø¸Ù‡Ø± (Ù†ÛŒÙ…Ø±ÙˆØ²):"+toClock(noon)+"<br>"+
  "Ø§Ø°Ø§Ù† Ø¹ØµØ± : "+ toClock(asrTime)+"<br>"+"ØºØ±ÙˆØ¨ Ø¢ÙØªØ§Ø¨ :"+toClock(sunset)+"<br>"+"Ø§Ø°Ø§Ù† Ù…ØºØ±Ø¨ :"
  +toClock(maghrib)+"<br>"+"Ø§Ø°Ø§Ù† Ø¹Ø´Ø§ :"+toClock(isha)+"<br>"+"Ù†ÛŒÙ…Ù‡ Ø´Ø¨ Ø´Ø±Ø¹ÛŒ : "+toClock(midnight);
    });
}

</script>

</body>
</html>
